{% extends "base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/base.css' %}">
<style>
    /* í´ë¦­ ê°€ëŠ¥í•œ ë¦¬ìŠ¤íŠ¸ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
    .receipt-list-card {
        cursor: pointer;
        transition: all 0.3s ease;
        border-left: 4px solid transparent;
    }
    .receipt-list-card:hover {
        transform: translateX(5px);
        border-left-color: var(--primary-yellow);
        box-shadow: var(--shadow-md);
    }
</style>
{% endblock %}

{% block content %}
<div class="content-wrapper">
    <!-- í—¤ë” ì„¹ì…˜ -->
    <div class="mb-4">
        <h2 class="mb-2">ğŸ“‘ ì¦ë¹™ ìë£Œ(ì˜ìˆ˜ì¦) ëª¨ì•„ë³´ê¸°</h2>
        <p class="text-muted">ì²¨ë¶€íŒŒì¼ì´ ë“±ë¡ë˜ì—ˆê±°ë‚˜ 'ì˜ìˆ˜ì¦' ë©”ëª¨ê°€ í¬í•¨ëœ ê±°ë˜ ë‚´ì—­ì…ë‹ˆë‹¤.</p>
    </div>

    <!-- ì¹´ë“œ ê·¸ë¦¬ë“œ - ê¹”ë”í•œ ìŠ¤íƒ€ì¼ -->
    <div class="row row-cols-1 row-cols-md-3 g-4 mb-5">
        {% for tx in page_obj %}
        <div class="col">
            <div class="card h-100 hover-float border-0">
                <!-- ì´ë¯¸ì§€ ì˜ì—­ -->
                <div class="card-img-top bg-light d-flex align-items-center justify-content-center" style="height: 200px; border-radius: 12px 12px 0 0;">
                    {% if tx.attachment %}
                        {% if tx.attachment.content_type == 'application/pdf' %}
                            <i class="bi bi-file-earmark-pdf text-danger" style="font-size: 4rem;"></i>
                        {% else %}
                            <img src="{{ tx.attachment.file.url }}" class="img-fluid w-100 h-100" style="object-fit: cover; border-radius: 12px 12px 0 0;" alt="ì˜ìˆ˜ì¦">
                        {% endif %}
                    {% else %}
                        <div class="text-center">
                            <i class="bi bi-camera-fill" style="font-size: 3rem; color: var(--gray-400);"></i>
                            <p class="small text-danger mt-2 mb-0">íŒŒì¼ì„ ë“±ë¡í•´ì£¼ì„¸ìš”</p>
                        </div>
                    {% endif %}
                </div>
                
                <!-- ì¹´ë“œ ë‚´ìš© -->
                <div class="card-body">
                    <h5 class="card-title text-truncate fw-bold mb-3">{{ tx.title|default:"ì œëª© ì—†ìŒ" }}</h5>
                    <div class="mb-2">
                        <strong>ê¸ˆì•¡:</strong> 
                        <span class="fw-bold" style="color: var(--gray-900);">{{ tx.amount|floatformat:0 }}ì›</span>
                    </div>
                    <div class="text-muted small">
                        <div class="mb-1">ğŸ“ ê³„ì¢Œ: {{ tx.account.name }}</div>
                        <div>ğŸ“… ë‚ ì§œ: {{ tx.occurred_at|date:"Y-m-d" }}</div>
                    </div>
                </div>
                
                <!-- ì¹´ë“œ í‘¸í„° ë²„íŠ¼ -->
                <div class="card-footer bg-transparent border-0 d-grid gap-2 pb-3">
                    {% if tx.attachment %}
                        <a href="{{ tx.attachment.file.url }}" class="btn btn-outline-primary btn-sm btn-hover-scale" target="_blank">
                            ğŸ“‚ íŒŒì¼ í¬ê²Œ ë³´ê¸°
                        </a>
                    {% endif %}
                    <a href="{% url 'transactions:transaction_detail' tx.pk %}?from=receipts" class="btn btn-warning btn-sm btn-hover-scale">
                        {% if tx.attachment %}âœ… ë‚´ìš© í™•ì¸í•˜ê¸°{% else %}â• ì˜ìˆ˜ì¦ ë“±ë¡í•˜ê¸°{% endif %}
                    </a>
                </div>
            </div>
        </div>
        {% empty %}
        <div class="col-12 text-center py-5">
            <div class="bg-yellow-soft p-5 rounded">
                <i class="bi bi-inbox" style="font-size: 3rem; color: var(--gray-400);"></i>
                <p class="text-muted mt-3 mb-0">ì•„ì§ ë“±ë¡ëœ ì¦ë¹™ ìë£Œê°€ ì—†ìŠµë‹ˆë‹¤.</p>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- êµ¬ë¶„ì„  -->
    <hr class="my-5" style="border-color: var(--gray-300);">

    <!-- ì¹´ë“œ ë¦¬ìŠ¤íŠ¸ ì„¹ì…˜ -->
    <h4 class="mb-3">ğŸ“‹ ì¦ë¹™ ìë£Œ ìƒì„¸ ë¦¬ìŠ¤íŠ¸</h4>
    
    <div class="row g-3">
        {% for transaction in page_obj %}
        <div class="col-12">
            <div class="card border-0 receipt-list-card" data-url="{% url 'transactions:transaction_detail' transaction.pk %}">
                <div class="card-body">
                    <div class="row align-items-center">
                        <!-- ë‚ ì§œ -->
                        <div class="col-auto">
                            <div class="text-muted small" style="min-width: 80px;">
                                {{ transaction.occurred_at|date:"m/d H:i" }}
                            </div>
                        </div>
                        
                        <!-- ìœ í˜• ë±ƒì§€ -->
                        <div class="col-auto">
                            <span class="badge {% if transaction.tx_type == 'IN' %}bg-success{% else %}bg-danger{% endif %}">
                                {{ transaction.get_tx_type_display }}
                            </span>
                        </div>
                        
                        <!-- ì œëª©/ê±°ë˜ì²˜ -->
                        <div class="col">
                            <strong>{{ transaction.title|default:transaction.memo|truncatechars:30 }}</strong>
                        </div>
                        
                        <!-- ê³„ì¢Œ -->
                        <div class="col-auto">
                            <small class="text-muted">{{ transaction.account.name }}</small>
                        </div>
                        
                        <!-- ê¸ˆì•¡ -->
                        <div class="col-auto">
                            <div class="fw-bold text-end" style="min-width: 100px; color: var(--gray-900);">
                                {{ transaction.amount|floatformat:0 }}ì›
                            </div>
                        </div>
                        
                        <!-- ì¦ë¹™ìƒíƒœ -->
                        <div class="col-auto">
                            {% if transaction.attachment %}
                                <span class="badge rounded-pill bg-info text-dark">ğŸ“ íŒŒì¼ ìˆìŒ</span>
                            {% else %}
                                <span class="badge rounded-pill bg-secondary">â“ ë¯¸ë“±ë¡</span>
                            {% endif %}
                        </div>
                        
                        <!-- ìˆ˜ì • ë²„íŠ¼ë§Œ -->
                        <div class="col-auto">
                            <a href="{% url 'transactions:transaction_update' transaction.pk %}" 
                               class="btn btn-outline-warning btn-sm btn-hover-scale"
                               onclick="event.stopPropagation();">
                                âœï¸ ìˆ˜ì •
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
    {% if page_obj.has_other_pages %}
    <div class="mt-4">
        <nav>
            <ul class="pagination pagination-sm justify-content-center">
                {% if page_obj.has_previous %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ page_obj.previous_page_number }}">ì´ì „</a>
                </li>
                {% endif %}
                
                {% for num in page_obj.paginator.page_range %}
                    {% if page_obj.number == num %}
                    <li class="page-item active">
                        <span class="page-link">{{ num }}</span>
                    </li>
                    {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                    <li class="page-item">
                        <a class="page-link" href="?page={{ num }}">{{ num }}</a>
                    </li>
                    {% endif %}
                {% endfor %}
                
                {% if page_obj.has_next %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ page_obj.next_page_number }}">ë‹¤ìŒ</a>
                </li>
                {% endif %}
            </ul>
        </nav>
    </div>
    {% endif %}
</div>

<!-- í´ë¦­ ì´ë²¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // ëª¨ë“  ë¦¬ìŠ¤íŠ¸ ì¹´ë“œì— í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€
    const cards = document.querySelectorAll('.receipt-list-card');
    cards.forEach(card => {
        card.addEventListener('click', function() {
            const url = this.getAttribute('data-url');
            if (url) {
                window.location.href = url;
            }
        });
    });
});
</script>
{% endblock %}