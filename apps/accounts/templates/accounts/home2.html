{% extends "base.html" %}
{% load humanize %}

{% block title %}ëŒ€ì‹œë³´ë“œ - ìŠ¤ë§ˆíŠ¸ ì‚¬ì—…ì ê°€ê³„ë¶€{% endblock %}

{% block content %}
<div class="container mt-3">

    <div class="card border-warning border-2 shadow-sm rounded-4 mb-5 bg-custom-light">
        <div class="card-body p-5">
            <h5 class="fw-bold mb-4">ğŸ“Š {{ year }}ë…„ {{ month }}ì›” ìš”ì•½</h5>
            
            <div class="row g-0 text-center">
                <div class="col-md-4 border-end"> <div class="py-3">
                        <p class="text-secondary fw-bold mb-1">ì´ ìˆ˜ì…</p>
                        <h2 class="fw-bold text-success mb-0">{{ total_income|floatformat:0|intcomma }}ì›</h2>
                    </div>
                </div>
                <div class="col-md-4 border-end">
                    <div class="py-3">
                        <p class="text-secondary fw-bold mb-1">ì´ ì§€ì¶œ</p>
                        <h2 class="fw-bold text-danger mb-0">{{ total_expense|floatformat:0|intcomma }}ì›</h2>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="py-3">
                        <p class="text-secondary fw-bold mb-1">ìˆœí•©</p> <h2 class="fw-bold text-primary mb-0">
                            {% if net_profit > 0 %}+{% endif %}{{ net_profit|floatformat:0|intcomma }}ì›
                        </h2>
                    </div>
                </div>
            </div>
            
            <div class="mt-4">
                <a href="#" class="text-decoration-none fw-bold small">ì›”ë³„ ìƒì„¸ ë³´ê¸°: ì›”ë³„ ìš”ì•½ í˜ì´ì§€ ë§Œë“¤ì–´ì§€ë©´ ì—°ê²° ì˜ˆì • â†’</a>
            </div>
        </div>
    </div>

    <div class="mb-4">
        <h3 class="fw-bold d-flex align-items-center">
            <span class="fs-2 me-2">ğŸ’¸</span>
            <span class="vertical-bar bg-warning me-3"></span>
            ìµœê·¼ ê±°ë˜
        </h3>
    </div>

    <div class="card border-0 shadow-sm rounded-4">
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover align-middle mb-0" style="min-width: 600px;">
                    <thead class="bg-light" style="border-top: 2px solid #ffc107; border-bottom: 2px solid #ffc107;">
                        <tr>
                            <th class="py-3 ps-4 text-secondary">ë‚ ì§œ</th>
                            <th class="py-3 text-secondary">êµ¬ë¶„</th>
                            <th class="py-3 text-secondary">ê±°ë˜ì²˜</th>
                            <th class="py-3 text-secondary">ì¹´í…Œê³ ë¦¬</th>
                            <th class="py-3 text-secondary">ê¸ˆì•¡</th>
                            <th class="py-3 pe-4 text-secondary">ê³„ì¢Œ</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% if recent_transactions %}
                            {% for transaction in recent_transactions %}
                            <tr onclick="location.href='{% url 'transactions:transaction_detail' transaction.id %}'" 
                                style="cursor: pointer;" 
                                class="hover-row">
            
                                <td class="ps-4 fw-bold text-secondary">{{ transaction.occurred_at|date:"Y-m-d" }}</td>
                                <td>
                                    {% if transaction.tx_type|upper == 'IN' %}
                                        <span class="badge rounded-pill bg-success-subtle text-success px-3">ìˆ˜ì…</span>
                                    {% else %}
                                        <span class="badge rounded-pill bg-danger-subtle text-danger px-3">ì§€ì¶œ</span>
                                    {% endif %}
                                </td>
                                <td class="text-secondary">
                                    {% if transaction.merchant %}
                                        {{ transaction.merchant.name }}
                                    {% elif transaction.merchant_name %}
                                        {{ transaction.merchant_name }}
                                    {% else %}
                                        <span class="text-muted">ë¯¸ì§€ì •</span>
                                    {% endif %}
                                </td>
                                <td class="text-secondary">{{ transaction.category.name }}</td>
                                <td class="fw-bold {% if transaction.tx_type|upper == 'IN' %}text-success{% else %}text-danger{% endif %}">
                                    {{ transaction.amount|floatformat:0|intcomma }}ì›
                                </td>
                                <td class="pe-4 text-secondary">{{ transaction.account.account_name }}</td>
                            </tr>
                            {% endfor %}
                        {% else %}
                            <tr>
                                <td colspan="6" class="text-center py-5 text-muted">
                ê±°ë˜ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.
                                </td>
                            </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

</div>

<style>
    /* ê³µí†µìœ¼ë¡œ ì“¸ ì—°í•œ ë°°ê²½ìƒ‰ (ìš”ì•½ ë°•ìŠ¤ & í…Œì´ë¸” í—¤ë”) */
    .bg-custom-light {
        background-color: #fffcf5 !important;
    }

    /* ì œëª© ì˜† ì„¸ë¡œ ë§‰ëŒ€ ìŠ¤íƒ€ì¼ */
    .vertical-bar {
        width: 6px;
        height: 28px;
        display: inline-block;
        border-radius: 2px;
    }
    
    /* ì¹´ë“œ ë‘¥ê¸€ê¸° */
    .rounded-4 {
        border-radius: 1rem !important;
    }
    
    /* í…Œì´ë¸” í—¤ë” ë°°ê²½ ì‚´ì§ ì—°í•˜ê²Œ */
    thead th {
        background-color: #fffcf5 !important; /* ì•„ì£¼ ì—°í•œ ë…¸ë€ìƒ‰ ë°°ê²½ */
    }
</style>
{% endblock %}