{% extends "base.html" %}
{% load static %}

{% block title %}ì‚¬ì—…ì¥ ê´€ë¦¬ - ìŠ¤ë§ˆíŠ¸ ì‚¬ì—…ì ê°€ê³„ë¶€{% endblock %}

{% block content %}
<div class="container-fluid px-4 py-3">
    
    <!-- í—¤ë” -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h3 class="mb-0 fw-bold text-dark">ğŸ¢ ì‚¬ì—…ì¥ ê´€ë¦¬</h3>
        <div class="d-flex gap-2">
            <a href="{% url 'businesses:business_deleted_list' %}" class="btn btn-outline-danger btn-sm px-3 d-flex align-items-center fw-bold shadow-sm" style="height: 38px;">
                ğŸ—‘ï¸ ì‚­ì œëœ ì‚¬ì—…ì¥
            </a>
            <a href="{% url 'businesses:business_create' %}" class="btn btn-success btn-sm px-3 d-flex align-items-center fw-bold shadow-sm" style="height: 38px;">
                â• ì‚¬ì—…ì¥ ë“±ë¡
            </a>
        </div>
    </div>

    <!-- ìš”ì•½ í†µê³„ (ìƒ‰ìƒ í†µì¼) -->
    <div class="row g-3 mb-4">
        <div class="col-md-4">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body p-3 text-center">
                    <small class="text-muted fw-bold">ì´ ì‚¬ì—…ì¥</small>
                    <h3 class="mt-2 mb-0 fw-bold text-dark">{{ total_count }}<small class="fs-6 fw-normal text-muted ms-1">ê°œ</small></h3>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body p-3 text-center">
                    <small class="text-muted fw-bold">ë³¸ì </small>
                    <h3 class="mt-2 mb-0 fw-bold text-dark">{{ main_count }}<small class="fs-6 fw-normal text-muted ms-1">ê°œ</small></h3>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body p-3 text-center">
                    <small class="text-muted fw-bold">ì§€ì </small>
                    <h3 class="mt-2 mb-0 fw-bold text-dark">{{ branch_count }}<small class="fs-6 fw-normal text-muted ms-1">ê°œ</small></h3>
                </div>
            </div>
        </div>
    </div>

    <!-- ê²€ìƒ‰ í•„í„° (ë²„íŠ¼ í¬ê¸° ì¡°ì •) -->
    <div class="card border-0 shadow-sm mb-3">
        <div class="card-body p-3">
            <form method="get">
                <div class="row g-2 align-items-end">
                    {% for field in search_form %}
                    <div class="col-md-3">
                        {{ field }}
                    </div>
                    {% endfor %}
                    <div class="col-md-2">
                        <button type="submit" class="btn btn-primary w-100 fw-bold" style="height: 48px;">ê²€ìƒ‰</button>
                    </div>
                    <div class="col-md-auto">
                        <a href="{% url 'businesses:business_list' %}" class="btn btn-outline-secondary fw-bold px-3" style="height: 48px; white-space: nowrap;">ì´ˆê¸°í™”</a>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- ì‚¬ì—…ì¥ ì¹´ë“œ -->
    <div class="row g-3">
        {% if businesses %}
            {% for business in businesses %}
            <div class="col-md-6 col-lg-4">
                <div class="card h-100 border-0 shadow-sm hover-shadow transition business-card" 
                     onclick="location.href='{% url 'businesses:business_detail' business.pk %}'"
                     style="cursor: pointer;">
                    <div class="card-body p-4 d-flex flex-column">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <h5 class="card-title fw-bold mb-0 text-truncate" style="max-width: 70%; color: #333;">
                                {{ business.name }}
                            </h5>
                            <span class="badge {% if business.branch_type == 'main' %}bg-primary rounded-pill{% else %}bg-secondary rounded-pill{% endif %}" style="font-size: 0.7rem;">
                                {{ business.get_branch_type_display }}
                            </span>
                        </div>
                        
                        <div class="mb-4">
                            <div class="text-muted small mb-1">
                                ğŸ“ {{ business.location|default:"ìœ„ì¹˜ ë¯¸ë“±ë¡" }}
                            </div>
                            <div class="text-muted small">
                                ğŸ“ {{ business.business_type|default:"ì—…ì¢… ë¯¸ë“±ë¡" }}
                            </div>
                        </div>

                        <div class="d-grid mt-auto gap-2"> <a href="{% url 'businesses:business_statistics' business.pk %}" class="btn btn-outline-info btn-sm fw-bold py-2">
                                ğŸ“Š í†µê³„ ë¶„ì„
                            </a>
                            <div class="btn btn-light btn-sm fw-bold text-secondary border py-2 custom-btn-hover">
                                ìƒì„¸ ì •ë³´ í™•ì¸ â†’
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <div class="col-12">
                <div class="card border-0 shadow-sm">
                    <div class="card-body text-center py-5">
                        <span class="fs-1">ğŸ“­</span>
                        <p class="mt-2">ì¡°ê±´ì— ë§ëŠ” ì‚¬ì—…ì¥ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                        <a href="{% url 'businesses:business_list' %}" class="btn btn-outline-secondary btn-sm">
                            ì „ì²´ ë³´ê¸°
                        </a>
                    </div>
                </div>
            </div>
        {% endif %}
    </div>
</div>

<style>
    .transition { transition: all 0.2s ease-in-out; }
    
    .hover-shadow:hover { 
        transform: translateY(-5px);
        box-shadow: 0 .75rem 1.5rem rgba(0,0,0,.12)!important;
    }

    .business-card:hover .custom-btn-hover {
        background-color: #e9ecef !important;
        color: #333 !important;
    }
</style>
{% endblock %}