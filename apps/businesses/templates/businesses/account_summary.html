{% extends 'base.html' %}
{% block title %}ê³„ì¢Œ ìš”ì•½ ëŒ€ì‹œë³´ë“œ{% endblock %}
{% block sidebar_nav %}
<ul class="nav-list">
    <li class="nav-item active">
        <a href="{% url 'accounts:home' %}" class="nav-link">
            <span class="nav-icon">ğŸ </span>
            <span class="nav-text">í™ˆ</span>
        </a>
    </li>
    <li class="nav-item">
        <a href="{% url 'accounts:home' %}" class="nav-link">
            <span class="nav-icon">ğŸ“Š</span>
            <span class="nav-text">ëŒ€ì‹œë³´ë“œ</span>
        </a>
    </li>
    <li class="nav-item">
        <a href="{% url 'transactions:transaction_list' %}" class="nav-link">
            <span class="nav-icon">ğŸ’°</span>
            <span class="nav-text">ê±°ë˜ ê´€ë¦¬</span>
        </a>
    </li>
    <li class="nav-item">
        <a href="#" class="nav-link">
            <span class="nav-icon">ğŸ‘¤</span>
            <span class="nav-text">í”„ë¡œí•„</span>
        </a>
    </li>
    <li class="nav-item logout">
        <form action="{% url 'accounts:logout' %}" method="post" style="display:inline;">
            {% csrf_token %}
            <button type="submit"
                style="background:none; border:none; color:blue; text-decoration:underline; cursor:pointer; padding:0;">
                ë¡œê·¸ì•„ì›ƒ
            </button>
        </form>
    </li>
</ul>
{% endblock %}
{% block top_nav %}
<div class="top-nav-links">
    <a href="{% url 'accounts:home' %}" class="nav-button">í™ˆ</a>
    <a href="{% url 'accounts:home' %}" class="nav-button">ëŒ€ì‹œë³´ë“œ</a>
    <a href="{% url 'transactions:transaction_list' %}" class="nav-button">ê±°ë˜ ê´€ë¦¬</a>
    <a href="{% url 'businesses:account_list' %}" class="nav-button active">ê³„ì¢Œ ê´€ë¦¬</a>
    <a href="{% url 'accounts:profile_detail' %}" class="nav-button">í”„ë¡œí•„</a>
    <span class="nav-divider">|</span>
    <span class="user-name">{{ user.username }} ë‹˜</span>
</div>
{% endblock %}
{% block content %}
<div class="container">
    <!-- í—¤ë” -->
    <div class="row mb-4">
        <div class="col-md-8">
            <h2>ğŸ“Š ê³„ì¢Œ ìš”ì•½ ëŒ€ì‹œë³´ë“œ</h2>
        </div>
        <div class="col-md-4 text-end">
            <a href="{% url 'businesses:account_list' %}" class="btn btn-outline-primary">
                ğŸ’³ ê³„ì¢Œ ëª©ë¡
            </a>
        </div>
    </div>
<!-- ì „ì²´ í†µê³„ ì¹´ë“œ -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card text-center">
            <div class="card-body">
                <small class="text-muted">ì´ ê³„ì¢Œ ìˆ˜</small>
                <h2 class="mt-2 mb-0">{{ total_count }}</h2>
                <small class="text-muted">ê°œ</small>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-center border-primary">
            <div class="card-body">
                <small class="text-muted">ì‚¬ì—…ìš© ê³„ì¢Œ</small>
                <h2 class="mt-2 mb-0 text-primary">{{ business_count }}</h2>
                <small class="text-muted">ê°œ</small>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-center">
            <div class="card-body">
                <small class="text-muted">ê°œì¸ìš© ê³„ì¢Œ</small>
                <h2 class="mt-2 mb-0 text-muted">{{ personal_count }}</h2>
                <small class="text-muted">ê°œ</small>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-center bg-success" style="color: white;">
            <div class="card-body">
                <small>ì´ ì”ì•¡</small>
                <h3 class="mt-2 mb-0">{{ total_balance|floatformat:0|default:"0" }}</h3>
                <small>ì›</small>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- ì‚¬ì—…ì¥ë³„ ê³„ì¢Œ í˜„í™© -->
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">ğŸ¢ ì‚¬ì—…ì¥ë³„ ê³„ì¢Œ í˜„í™©</h5>
            </div>
            <div class="card-body">
                {% if business_accounts %}
                    <div class="table-responsive">
                        <table class="table mb-0">
                            <thead>
                                <tr>
                                    <th>ì‚¬ì—…ì¥</th>
                                    <th class="text-center">ê³„ì¢Œ ìˆ˜</th>
                                    <th class="text-end">ì´ ì”ì•¡</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for ba in business_accounts %}
                                <tr>
                                    <td>
                                        ğŸ¢ {{ ba.business__name }}
                                    </td>
                                    <td class="text-center">
                                        <span class="badge badge-primary">{{ ba.count }}ê°œ</span>
                                    </td>
                                    <td class="text-end">
                                        <strong>{{ ba.total_balance|floatformat:0|default:"0" }}ì›</strong>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <div class="text-center py-4">
                        <p class="text-muted mb-0">ğŸ“­ ì‚¬ì—…ì¥ì— ì—°ê²°ëœ ê³„ì¢Œê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- ì€í–‰ë³„ ê³„ì¢Œ í˜„í™© -->
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">ğŸ¦ ì€í–‰ë³„ ê³„ì¢Œ í˜„í™© (ìƒìœ„ 5ê°œ)</h5>
            </div>
            <div class="card-body">
                {% if bank_accounts %}
                    <div class="table-responsive">
                        <table class="table mb-0">
                            <thead>
                                <tr>
                                    <th>ì€í–‰</th>
                                    <th class="text-center">ê³„ì¢Œ ìˆ˜</th>
                                    <th class="text-end">ì´ ì”ì•¡</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for ba in bank_accounts %}
                                <tr>
                                    <td>
                                        ğŸ¦ {{ ba.bank_name }}
                                    </td>
                                    <td class="text-center">
                                        <span class="badge badge-secondary">{{ ba.count }}ê°œ</span>
                                    </td>
                                    <td class="text-end">
                                        <strong>{{ ba.total_balance|floatformat:0|default:"0" }}ì›</strong>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <div class="text-center py-4">
                        <p class="text-muted mb-0">ğŸ“­ ë“±ë¡ëœ ê³„ì¢Œê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- ì”ì•¡ ë¶€ì¡± ê³„ì¢Œ -->
<div class="row">
    <div class="col-12">
        <div class="card border-warning">
            <div class="card-header bg-warning">
                <h5 class="mb-0">
                    âš ï¸ ì”ì•¡ ë¶€ì¡± ê³„ì¢Œ ({{ low_balance_threshold|floatformat:0 }}ì› ë¯¸ë§Œ)
                </h5>
            </div>
            <div class="card-body">
                {% if low_balance_accounts %}
                    <div class="table-responsive">
                        <table class="table mb-0">
                            <thead>
                                <tr>
                                    <th>ê³„ì¢Œëª…</th>
                                    <th>ì€í–‰</th>
                                    <th>ê³„ì¢Œë²ˆí˜¸</th>
                                    <th>êµ¬ë¶„</th>
                                    <th class="text-end">ì”ì•¡</th>
                                    <th class="text-center">ê´€ë¦¬</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for account in low_balance_accounts %}
                                <tr>
                                    <td>
                                        <strong>{{ account.name }}</strong>
                                    </td>
                                    <td>{{ account.bank_name }}</td>
                                    <td><code>{{ account.get_masked_account_number }}</code></td>
                                    <td>
                                        {% if account.account_type == 'business' %}
                                            <span class="badge badge-primary">ì‚¬ì—…ìš©</span>
                                        {% else %}
                                            <span class="badge badge-secondary">ê°œì¸ìš©</span>
                                        {% endif %}
                                    </td>
                                    <td class="text-end">
                                        <span class="text-danger">
                                            <strong>{{ account.balance|floatformat:0|default:"0" }}ì›</strong>
                                        </span>
                                    </td>
                                    <td class="text-center">
                                        <a href="{% url 'businesses:account_detail' account.pk %}" 
                                           class="btn btn-outline-primary btn-sm">
                                            ìƒì„¸
                                        </a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <div class="alert alert-success mb-0">
                        âœ… ëª¨ë“  ê³„ì¢Œì˜ ì”ì•¡ì´ ì¶©ë¶„í•©ë‹ˆë‹¤.
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
</div>
{% endblock %}