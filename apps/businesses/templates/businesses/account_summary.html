{% extends 'base.html' %}
{% load humanize %}

{% block title %}ê³„ì¢Œ ìš”ì•½ ë³´ê¸° - ìŠ¤ë§ˆíŠ¸ ì‚¬ì—…ì ê°€ê³„ë¶€{% endblock %}

{% block content %}
<div class="container-fluid px-4 py-3">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h3 class="mb-0 fw-bold text-dark">ğŸ“Š ê³„ì¢Œ ìš”ì•½ ë³´ê¸°</h3>
        <a href="{% url 'businesses:account_list' %}" class="btn btn-outline-secondary btn-sm px-3 d-flex align-items-center fw-bold shadow-sm" style="height: 38px;">
            â† ê³„ì¢Œ ê´€ë¦¬
        </a>
    </div>

    <div class="row g-3 mb-4">
        <div class="col-md-3">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body p-3 text-center">
                    <small class="text-muted fw-bold">ì´ ê³„ì¢Œ ìˆ˜</small>
                    <h3 class="mt-2 mb-0 fw-bold text-dark">{{ total_count }}<small class="fs-6 fw-normal text-muted ms-1">ê°œ</small></h3>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body p-3 text-center">
                    <small class="text-muted fw-bold">ì‚¬ì—…ìš© ê³„ì¢Œ</small>
                    <h3 class="mt-2 mb-0 fw-bold text-dark">{{ business_count }}<small class="fs-6 fw-normal text-muted ms-1">ê°œ</small></h3>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body p-3 text-center">
                    <small class="text-muted fw-bold">ê°œì¸ìš© ê³„ì¢Œ</small>
                    <h3 class="mt-2 mb-0 fw-bold text-secondary">{{ personal_count }}<small class="fs-6 fw-normal text-muted ms-1">ê°œ</small></h3>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 shadow-sm h-100 bg-success text-white">
                <div class="card-body p-3 text-center">
                    <small class="fw-bold opacity-75">ì´ ì”ì•¡ í•©ê³„</small>
                    <h3 class="mt-2 mb-0 fw-bold">{{ total_balance|floatformat:0|intcomma }}<small class="fs-6 fw-normal opacity-75 ms-1">ì›</small></h3>
                </div>
            </div>
        </div>
    </div>

    <div class="row g-4 mb-4">
        <div class="col-lg-6">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-header bg-white py-3 border-0">
                    <h5 class="mb-0 fw-bold"><span class="me-2">ğŸ¢</span>ì‚¬ì—…ì¥ë³„ ê³„ì¢Œ í˜„í™©</h5>
                </div>
                <div class="card-body p-0">
                    {% if business_accounts %}
                    <div class="table-responsive">
                        <table class="table table-hover align-middle mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th class="ps-4">ì‚¬ì—…ì¥</th>
                                    <th class="text-center">ê³„ì¢Œ</th>
                                    <th class="text-end pe-4">ì´ ì”ì•¡</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for ba in business_accounts %}
                                <tr>
                                    <td class="ps-4 fw-bold text-dark">{{ ba.business__name }}</td>
                                    <td class="text-center">
                                        <span class="badge bg-success-subtle text-success rounded-pill px-3">{{ ba.count }}ê°œ</span>
                                    </td>
                                    <td class="text-end pe-4 fw-bold">{{ ba.total_balance|floatformat:0|intcomma }}ì›</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <div class="text-center py-5 text-muted">ğŸ“­ ì—°ê²°ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="col-lg-6">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-header bg-white py-3 border-0">
                    <h5 class="mb-0 fw-bold"><span class="me-2">ğŸ¦</span>ì€í–‰ë³„ ì ìœ  í˜„í™© (TOP 5)</h5>
                </div>
                <div class="card-body p-0">
                    {% if bank_accounts %}
                    <div class="table-responsive">
                        <table class="table table-hover align-middle mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th class="ps-4">ì€í–‰ëª…</th>
                                    <th class="text-center">ê³„ì¢Œ</th>
                                    <th class="text-end pe-4">ì´ ì”ì•¡</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for ba in bank_accounts %}
                                <tr>
                                    <td class="ps-4 text-dark">{{ ba.bank_name }}</td>
                                    <td class="text-center">
                                        <span class="badge bg-light text-dark border rounded-pill px-3">{{ ba.count }}ê°œ</span>
                                    </td>
                                    <td class="text-end pe-4 fw-bold">{{ ba.total_balance|floatformat:0|intcomma }}ì›</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <div class="text-center py-5 text-muted">ğŸ“­ ë“±ë¡ëœ ê³„ì¢Œê°€ ì—†ìŠµë‹ˆë‹¤.</div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-12">
            <div class="card border-0 shadow-sm border-start border-warning border-4">
                <div class="card-header bg-white py-3 border-0">
                    <h5 class="mb-0 fw-bold text-warning">
                        <span class="me-2">âš ï¸</span>ì”ì•¡ ë¶€ì¡± ê²½ê³  <small class="text-muted fw-normal fs-6">({{ low_balance_threshold|floatformat:0|intcomma }}ì› ë¯¸ë§Œ)</small>
                    </h5>
                </div>
                <div class="card-body p-0">
                    {% if low_balance_accounts %}
                    <div class="table-responsive">
                        <table class="table table-hover align-middle mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th class="ps-4">ê³„ì¢Œëª…</th>
                                    <th>ì€í–‰ / ê³„ì¢Œë²ˆí˜¸</th>
                                    <th class="text-center">êµ¬ë¶„</th>
                                    <th class="text-end pe-4">í˜„ì¬ ì”ì•¡</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for account in low_balance_accounts %}
                                <tr>
                                    <td class="ps-4">
                                        <a href="{% url 'businesses:account_detail' account.pk %}" class="text-decoration-none fw-bold text-dark">
                                            {{ account.name }}
                                        </a>
                                    </td>
                                    <td>
                                        <div class="small text-dark">{{ account.bank_name }}</div>
                                        <div class="small text-muted font-monospace">{{ account.get_masked_account_number }}</div>
                                    </td>
                                    <td class="text-center">
                                        {% if account.account_type == 'business' %}
                                            <span class="badge bg-success-subtle text-success">ì‚¬ì—…ìš©</span>
                                        {% else %}
                                            <span class="badge bg-light text-muted border">ê°œì¸ìš©</span>
                                        {% endif %}
                                    </td>
                                    <td class="text-end pe-4 text-danger fw-bold">
                                        {{ account.balance|floatformat:0|intcomma }}ì›
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <div class="p-4 text-center">
                        <div class="alert alert-success d-inline-block px-5 mb-0 border-0 shadow-sm text-success fw-bold">
                            âœ¨ ëª¨ë“  ê³„ì¢Œì˜ ì”ì•¡ì´ ì¶©ë¶„í•©ë‹ˆë‹¤.
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}