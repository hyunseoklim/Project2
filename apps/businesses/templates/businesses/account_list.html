{% extends 'base.html' %}
{% block title %}ê³„ì¢Œ ëª©ë¡{% endblock %}

{% block top_nav %}
<div class="top-nav-links">
    <a href="{% url 'accounts:home' %}" class="nav-button">ëŒ€ì‹œë³´ë“œ</a>
    <span class="nav-divider">|</span>
    <a href="{% url 'transactions:transaction_list' %}" class="nav-button">ê±°ë˜ ê´€ë¦¬</a>
    <span class="nav-divider">|</span>
    <a href="{% url 'businesses:business_list' %}" class="nav-button">ì‚¬ì—…ì¥ ê´€ë¦¬</a>
    <span class="nav-divider">|</span>
    <a href="{% url 'businesses:account_list' %}" class="nav-button active">ê³„ì¢Œ ê´€ë¦¬</a>
    <span class="nav-divider">|</span>
    <a href="{% url 'accounts:profile_detail' %}" class="nav-button">í”„ë¡œí•„</a>
    {% if user.is_authenticated %}
    <span class="nav-divider">|</span>
    <span class="user-name">{{ user.username }}</span>
    <span class="nav-divider">|</span>
    <form method="post" action="{% url 'accounts:logout' %}" style="display:inline;">
        {% csrf_token %}
        <button type="submit" class="nav-button logout-btn" style="background:none;border:none;padding:0.5rem 1rem;">ë¡œê·¸ì•„ì›ƒ</button>
    </form>
    {% endif %}
</div>
{% endblock %}

{% block sidebar_nav %}
<ul class="nav-list">
    <li class="nav-item active">
        <a href="{% url 'accounts:home' %}" class="nav-link">
            <span class="nav-icon">ğŸ </span>
            <span class="nav-text">í™ˆ</span>
        </a>
    </li>
    <li class="nav-item">
        <a href="{% url 'accounts:home' %}" class="nav-link">
            <span class="nav-icon">ğŸ“Š</span>
            <span class="nav-text">ëŒ€ì‹œë³´ë“œ</span>
        </a>
    </li>
    <li class="nav-item">
        <a href="{% url 'transactions:transaction_list' %}" class="nav-link">
            <span class="nav-icon">ğŸ’°</span>
            <span class="nav-text">ê±°ë˜ ê´€ë¦¬</span>
        </a>
    </li>
    <li class="nav-item">
        <a href="#" class="nav-link">
            <span class="nav-icon">ğŸ‘¤</span>
            <span class="nav-text">í”„ë¡œí•„</span>
        </a>
    </li>
    <li class="nav-item logout">
        <form action="{% url 'accounts:logout' %}" method="post" style="display:inline;">
            {% csrf_token %}
            <button type="submit"
                style="background:none; border:none; color:blue; text-decoration:underline; cursor:pointer; padding:0;">
                ë¡œê·¸ì•„ì›ƒ
            </button>
        </form>
    </li>
</ul>
{% endblock %}
{% block content %}
<div class="container">

    <!-- í˜ì´ì§€ ì œëª© -->
    <div class="row mb-4">
        <div class="col-md-8">
            <h2>ğŸ’³ ê³„ì¢Œ ê´€ë¦¬</h2>
        </div>
        <div class="col-md-4 text-end">
        <a href="{% url 'businesses:account_deleted_list' %}" class="btn btn-outline-danger btn-sm">ğŸ—‘ï¸ ì‚­ì œëœ ê³„ì¢Œ</a>
            <a href="{% url 'businesses:account_summary' %}" class="btn btn-outline-primary btn-sm">ğŸ“Š ëŒ€ì‹œë³´ë“œ</a>
            <a href="{% url 'businesses:account_create' %}" class="btn btn-success btn-sm">â• ê³„ì¢Œ ë“±ë¡</a>
        </div>
    </div>

<!-- ìš”ì•½ í†µê³„ ì¹´ë“œ -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card text-center">
            <div class="card-body">
                <small class="text-muted">ì´ ê³„ì¢Œ</small>
                <h3 class="mt-2 mb-0">{{ total_count }}</h3>
                <small class="text-muted">ê°œ</small>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-center border-primary">
            <div class="card-body">
                <small class="text-muted">ì‚¬ì—…ìš©</small>
                <h3 class="mt-2 mb-0 text-primary">{{ business_count }}</h3>
                <small class="text-muted">ê°œ</small>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-center">
            <div class="card-body">
                <small class="text-muted">ê°œì¸ìš©</small>
                <h3 class="mt-2 mb-0 text-muted">{{ personal_count }}</h3>
                <small class="text-muted">ê°œ</small>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-center bg-success" style="color: white;">
            <div class="card-body">
                <small>ì´ ì”ì•¡</small>
                <h4 class="mt-2 mb-0">{{ total_balance|floatformat:0|default:"0" }}</h4>
                <small>ì›</small>
            </div>
        </div>
    </div>
</div>

<!-- ê²€ìƒ‰ ë° í•„í„° -->
<div class="card mb-4">
    <div class="card-header">ğŸ” ê²€ìƒ‰ ë° í•„í„°</div>
    <div class="card-body">
        <form method="get">
            <div class="row">
                <div class="col-md-3 mb-3">
                    <label class="form-label">ê³„ì¢Œ êµ¬ë¶„</label>
                    {{ search_form.account_type }}
                </div>
                <div class="col-md-3 mb-3">
                    <label class="form-label">ì‚¬ì—…ì¥</label>
                    {{ search_form.business }}
                </div>
                <div class="col-md-4 mb-3">
                    <label class="form-label">ê²€ìƒ‰ì–´</label>
                    {{ search_form.search }}
                </div>
                <div class="col-md-2 mb-3">
                    <label class="form-label">&nbsp;</label>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">ê²€ìƒ‰</button>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- ê³„ì¢Œ ëª©ë¡ í…Œì´ë¸” -->
<div class="card">
    <div class="card-header">
        <h5 class="mb-0">ğŸ“‹ ê³„ì¢Œ ëª©ë¡</h5>
    </div>
    {% if page_obj %}
        <div class="table-responsive">
            <table class="table">
                <thead>
                    <tr>
                        <th>ê³„ì¢Œëª…</th>
                        <th>ì€í–‰</th>
                        <th>ê³„ì¢Œë²ˆí˜¸</th>
                        <th>êµ¬ë¶„</th>
                        <th>ì‚¬ì—…ì¥</th>
                        <th class="text-end">ì”ì•¡</th>
                        <th>ë“±ë¡ì¼</th>
                        <th class="text-center">ê´€ë¦¬</th>
                    </tr>
                </thead>
                <tbody>
                    {% for account in page_obj %}
                    <tr>
                        <td>
                            <a href="{% url 'businesses:account_detail' account.pk %}">
                                <strong>{{ account.name }}</strong>
                            </a>
                        </td>
                        <td>{{ account.bank_name }}</td>
                        <td><code>{{ account.get_masked_account_number }}</code></td>
                        <td>
                            {% if account.account_type == 'business' %}
                                <span class="badge badge-primary">ì‚¬ì—…ìš©</span>
                            {% else %}
                                <span class="badge badge-secondary">ê°œì¸ìš©</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if account.business %}
                                <small>{{ account.business.name }}</small>
                            {% else %}
                                <span class="text-muted">-</span>
                            {% endif %}
                        </td>
                        <td class="text-end">
                            <strong>{{ account.balance|floatformat:0|default:"0" }}ì›</strong>
                        </td>
                        <td>
                            <small class="text-muted">{{ account.created_at|date:"Y-m-d" }}</small>
                        </td>
                        <td class="text-center">
                            <a href="{% url 'businesses:account_update' account.pk %}" 
                               class="btn btn-outline-primary btn-sm">ìˆ˜ì •</a>
                            <a href="{% url 'businesses:account_delete' account.pk %}" 
                               class="btn btn-outline-danger btn-sm">ì‚­ì œ</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
        {% if page_obj.has_other_pages %}
        <div class="card-footer">
            <ul class="pagination">
                {% if page_obj.has_previous %}
                    <li class="page-item">
                        <a class="page-link" href="?page=1{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">
                            ì²˜ìŒ
                        </a>
                    </li>
                    <li class="page-item">
                        <a class="page-link" href="?page={{ page_obj.previous_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">
                            ì´ì „
                        </a>
                    </li>
                {% endif %}

                <li class="page-item active">
                    <span class="page-link">
                        {{ page_obj.number }} / {{ page_obj.paginator.num_pages }}
                    </span>
                </li>

                {% if page_obj.has_next %}
                    <li class="page-item">
                        <a class="page-link" href="?page={{ page_obj.next_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">
                            ë‹¤ìŒ
                        </a>
                    </li>
                    <li class="page-item">
                        <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">
                            ë§ˆì§€ë§‰
                        </a>
                    </li>
                {% endif %}
            </ul>
        </div>
        {% endif %}
    {% else %}
        <div class="card-body text-center py-5">
            <p class="text-muted mb-3">ğŸ“­ ë“±ë¡ëœ ê³„ì¢Œê°€ ì—†ìŠµë‹ˆë‹¤.</p>
            <a href="{% url 'businesses:account_create' %}" class="btn btn-primary">
                ì²« ê³„ì¢Œ ë“±ë¡í•˜ê¸°
            </a>
        </div>
    {% endif %}
</div>
</div>
{% endblock %}